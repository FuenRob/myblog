{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/como-usar-los-secrets-de-github/","result":{"data":{"markdownRemark":{"html":"<p>Lo más probable es que como desarrollador hayas usado o uses en tu día a día la plataforma de Github para proteger y versionar tu código.</p>\n<p>Desde hace mucho tiempo la plataforma de esta empresa, que inicialmente solo se usaba para almacenar el código de tu aplicación, también puede funcionar como un servidor de tu web y por ello tiene los llamados Secrets y Actions, dos tecnologías que debes dominar si quieres publicar, de forma segura, tu plataforma en el servidor de Github.</p>\n<p>Empecemos por el principio. </p>\n<h1>¿Qué son los Secrets?</h1>\n<p>Github llama Secrets a los datos que no se deben compartir en el propio código por seguridad. Por ejemplo, la semilla o seem que estamos usando para encriptar y generar un JSON Web token válido para nuestros servidor de API REST.</p>\n<h1>¿Qué son los Actions?</h1>\n<p>Son flujos de trabajo que desatamos cuando hacemos una determinada acción sobre nuestro repositorio. Por ejemplo, un sistema de integración continua en el que le decimos que cada vez que se haga push sobre la rama Master se ejecute una acción.</p>\n<p>Una vez que conocemos la teoría, vamos a la práctica.</p>\n<h1>Usar Secrets y Actions</h1>\n<h2>Crear un Secret en Github</h2>\n<p>En este ejemplo vamos a crear un Secret para guardar la KEY de la API de Google maps, de este modo si alguien decide coger nuestro código, no tendrá nuestra clave de API de Google maps. <em>(Todos sabemos que la podría sacar inspeccionando elemento en su google chrome y revisando el header de la web, pero no queremos ponérselo tan fácil.)</em></p>\n<p>Vamos a las Settings de nuestro repositorio de Github, en el que queremos usar los Secrets, y en el menú de la izquierda nos aparece la opción de los secrets y al no tener ninguno lo veremos así:</p>\n<p><img src=\"https://dev-to-uploads.s3.amazonaws.com/i/e2mp8y6oxzg7dpqjf8g2.png\" alt=\"Imagen de Secrets 1\"></p>\n<p>Pulsando en <strong>New Secret</strong> cargas el formulario para añadir un nuevo Secret a ese repositorio, en el que deberas indicar un nombre y un valor al secreto:</p>\n<p><img src=\"https://dev-to-uploads.s3.amazonaws.com/i/0pfayzar5zaa9bzw1jrj.png\" alt=\"Imagen de Secrets 2\"></p>\n<p>Una vez ambos datos sean correctos, guarda el secreto y ya habrás generado con éxito el primer Secret de tu repositorio, pero ahora debemos usarlo en nuestro código y para ello tenemos que crear un Action para nuestro repositorio.</p>\n<h2>Crear un Action CI</h2>\n<p>Para ello vamos a pinchar en Actions, dentro del menú de nuestro repositorio:</p>\n<p><img src=\"https://dev-to-uploads.s3.amazonaws.com/i/ep7ru0w8mbbnrap0fn8t.png\" alt=\"Imagen de Secrets 3\"></p>\n<p>Al pulsar en Actions lo primero que veremos será los workflows sugeridos por Github dependiendo el lenguaje que usemos en ese repositorio:</p>\n<p><img src=\"https://dev-to-uploads.s3.amazonaws.com/i/5qfn1a0nsi9874xr2t1e.png\" alt=\"Imagen de Secrets 4\"></p>\n<p>Aunque si bajamos hasta abajo del todo veremos una opción para añadir un workflow en blanco, lo que nos genera una estructura básica:</p>\n<p><img src=\"https://dev-to-uploads.s3.amazonaws.com/i/f08ih50esf5ogb5zssuj.png\" alt=\"Imagen de Secrets 5\"></p>\n<p>En este caso seleccionamos la opción de <em>\"Manual workflow\"</em> porque más abajo tenemos un ejemplo de configuración de CI (Integración Continua) para asignar el Secret a una variable de entorno, lo que nos permitirá usar esa variable en nuestro código. Basta con que sustituyas el código de ejemplo por este:</p>\n<pre><code>name: Build and Deploy to GitHub Pages on Push\n\non:\n  push:\n    branches:\n      - master\n\njobs:\n  build-and-deploy:\n    runs-on: ubuntu-latest\n    steps:\n      - name: Checkout\n        uses: actions/checkout@master\n\n      - name: Build and Deploy\n        uses: JamesIves/github-pages-deploy-action@master\n        env:\n          ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }}\n          API_GOOGLE_MAP: ${{ secrets.API_GOOGLE_MAP }}\n          BRANCH: gh-pages\n          FOLDER: public\n          BUILD_SCRIPT: yarn &#x26;&#x26; yarn run build\n</code></pre>\n<p>En esta configuración hacemos que cuando se haga un push a la rama master de nuestro repositorio se ejecute la acción o Job: build-and-deploy que monta nuestra web sobre la última versión de un ubuntu y ejecuta dos acciones:</p>\n<ol>\n<li>Checkout: Lanza el comando de git checkout a la rama master dentro del ubuntu.</li>\n<li>Build and Deploy: Primero compila el código de nuestra web, lanzado el comando yarn run build. Después hace la acción de asignar las variables de entorno con los secrets que hemos creado : secrets.API<em>GOOGLE</em>MAP a la variable de entorno API<em>GOOGLE</em>MAP. Para ello usamos lo que ha desarrollado James Ives en su repositorio: github-pages-deploy-action@master pasándole las variables que necesita en el env. El resultado de este Job se guarda en la rama indicada en la variable: BRANCH y en este caso es el contenido de la carpeta (FOLDER) public de nuestro código.</li>\n</ol>\n<p>En este ejemplo, uso este action para una web hecha con Gatsby, por eso uso la carpeta public ya que es donde genera el código estático de la web al lanzar el comando build.</p>\n<h2>Usar los Secrets como variables de entorno</h2>\n<p>Por ultimo, para usar las variables de entorno en nuestro código, solo tenemos que poner lo siguiente: </p>\n<pre><code>process.env.NOMBRE_VARIABLE; // in JavaScript\ngetenv('MODE'); // in PHP\n</code></pre>","frontmatter":{"title":"Cómo usar los secrets de Github","date":"2020-11-08","cover":{"publicURL":"/static/ff8131d6e5212fdddaddb1f20be4e03e/actions-github-banner.png","childImageSharp":{"sizes":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABaElEQVQoz42R3UvCUBjGj27qnBYVGERfFJQQOjf3IRlYSYkXdhHlVRBzc2dmFJotFCpv+sN7zjmlXkXwcHi3s9/zPu87IpU8Wffkkif9QykzlI3u7JFImkeO7mPFTlzr8PMveO00Up3HeNH9gRUzOGyNc7Wn1Wofyjghz+KzOLo/JzX4utnq80pttHwyUOwHNCNJo7tZH6p2mCp30xYFQAouxO74OQvMTquXO39bPxsuVXoxfJAw/O3L0W7j9aA13rp42WmMNuqDvWaUb032mxHswMMx7fTFtIrVU22KTnHERmejPUXy47svvT3NX020mw+9/WncTgvX77AWnfkgPotTdLEaSCp1CC4wp2LRbCXM2FRF4TDvrBNiFrE/MGkr4A2DjI33VCAMFk5i4Wzn2ryQeU8UYGDKYAc9Qg4HRKQSi0HIBI83K6BkmY9qBpg/9mvKCvafOZw0acqkABZhITCCXxS+wcK/ASlEfsB3Sw3LAAAAAElFTkSuQmCC","aspectRatio":1.9083969465648856,"src":"/static/ff8131d6e5212fdddaddb1f20be4e03e/f3583/actions-github-banner.png","srcSet":"/static/ff8131d6e5212fdddaddb1f20be4e03e/46604/actions-github-banner.png 500w,\n/static/ff8131d6e5212fdddaddb1f20be4e03e/31987/actions-github-banner.png 1000w,\n/static/ff8131d6e5212fdddaddb1f20be4e03e/f3583/actions-github-banner.png 1200w","sizes":"(max-width: 1200px) 100vw, 1200px"}}}},"fields":{"slug":"/blog/como-usar-los-secrets-de-github/"}},"site":{"siteMetadata":{"comments":{"GATSBY_DISQUS_NAME":"fuenrob"}}}},"pageContext":{"slug":"/blog/como-usar-los-secrets-de-github/"}}}