{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/generar-json-web-token-en-nodejs/","result":{"data":{"markdownRemark":{"html":"<p>Hoy os traigo una publicación sobre el uso de JSON Web Token en uno de nuestros proyectos para generar, en la función de login, un token que se pueda validar posteriormente antes de hacer una acción, por ejemplo de actualizado de usuarios.</p>\n<p>Utilizaremos esta tecnología porque utiliza el algoritmo de encriptación HS256 y además, para generar el token se basa en una semilla (seem) que nos podemos inventar o generar, sin la cual, no se puede descifrar la información que contiene el token. Todo esto hace que sea uno de los procesos más seguros de tokerizado. </p>\n<p>Para ello vamos a instalar el paquete de node para <strong>jsonwebtoken</strong> con el siguiente comando:</p>\n<pre><code>npm install jsonwebtoken --save\n</code></pre>\n<p>Después para usarlo en nuestro código, vale con importar el paquete y llamar a su función sign de la siguiente manera:</p>\n<pre><code>const jwt = require('jsonwebtoken');\n\nlet token = jwt.sign({\n    infoUser\n}, 'este-es-el-seed', {expiresIn: '48h'});\n</code></pre>\n<p>El token que genera la siguiente función tendrá una duración de 48 horas, dos días, y utilizará la semilla este-es-el-seed para encriptar la información de usuario.</p>\n<p>Si quieres usarlo en una función login podría ser algo así:</p>\n<pre><code>const express = require('express');\n// Usamos bcrypt para comprobar la contraseña\nconst bcrypt = require('bcrypt');\nconst jwt = require('jsonwebtoken');\n// Importamos el modelo de usuario de otro fichero\nconst User = require('./models/User');\nconst app = express();\n\napp.post('/login', (req, res) =>{\n    \n    let body = req.body;\n\n    User.findOne({email: body.email}, (err, user) => {\n        if(err){\n            return res.status(500).json({\n               ok: false,\n               err  \n            });\n        }\n\n        if(!user){\n            return res.status(400).json({\n                ok: false,\n                err: {\n                    message: 'Usuario o contraseña incrorrectos'\n                }\n            });\n        }\n\n        if(!bcrypt.compareSync(body.password, user.password)){\n            return res.status(400).json({\n                ok: false,\n                err: {\n                    message: 'Usuario o contraseña incrorrectos'\n                }\n            });\n        }\n\n        let token = jwt.sign({\n            user\n        }, 'este-es-el-seed', {expiresIn: '48h'});\n\n        res.json({\n            ok: true,\n            user,\n            token\n        });\n\n    });\n});\n</code></pre>\n<p>En la respuesta correcta de la función de login, nuestro servidor de NodeJS va a devolver la información de nuestro usuario, que la habremos definido previamente en nuestro modelo, y el token. La capa frontend ya puede guardar ese token como variable local de navegador y deberá mandarlo con el resto de peticiones para validar que el usuario creado puede ejecutar esas funciones.</p>","frontmatter":{"title":"Generar un JSON Web Token (JWT) en NodeJS","date":"2020-05-30","cover":{"publicURL":"/static/5c7dba3d346a6301edc7ddcf417b27cf/generar-json-web-token-en-nodejs.png","childImageSharp":{"sizes":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAuUlEQVQoz7WSywrCMBBF8/+f4sI/EFSQRlzoyo1YSVpLW63EPtIkTTKG1pW0VRQPs5nHvQPDoMkPIBjBtjEM+lrZJzYGjgeZ1VWgC18WJ8VDxWszi2FKgMmn7YDYddbY3Hm2FZdVlSxKtheuTArw0tbcDm3Oc/A8MV+GkZ9hcd3wGxbxjsUJiQTg1I6KrQVKpZs9B7o0mhtdQMkqSolxzsp+fLAPQM0LSrmQUjaqS7uCavpAf3uSdzwA8Vlfe90LDgsAAAAASUVORK5CYII=","aspectRatio":1.7793594306049823,"src":"/static/5c7dba3d346a6301edc7ddcf417b27cf/eeb1b/generar-json-web-token-en-nodejs.png","srcSet":"/static/5c7dba3d346a6301edc7ddcf417b27cf/46604/generar-json-web-token-en-nodejs.png 500w,\n/static/5c7dba3d346a6301edc7ddcf417b27cf/31987/generar-json-web-token-en-nodejs.png 1000w,\n/static/5c7dba3d346a6301edc7ddcf417b27cf/eeb1b/generar-json-web-token-en-nodejs.png 1920w","sizes":"(max-width: 1920px) 100vw, 1920px"}}}},"fields":{"slug":"/blog/generar-json-web-token-en-nodejs/"}},"site":{"siteMetadata":{"comments":{"GATSBY_DISQUS_NAME":"fuenrob"}}}},"pageContext":{"slug":"/blog/generar-json-web-token-en-nodejs/"}},"staticQueryHashes":["414621567","754622331"]}